- id: 'Rubbish: Update Bin Night Sensors'
  alias: 'Rubbish: Update Bin Night Sensors'
  trigger:
  - event: start
    platform: homeassistant
  - hours: /1
    platform: time_pattern
  action:
  - entity_id: sensor.recycling_bin_today, sensor.recycling_bin_tomorrow, sensor.landfill_bin_today,
      sensor.landfill_bin_tomorrow, sensor.garden_bin_today, sensor.garden_bin_tomorrow
    service: homeassistant.update_entity
- id: 'Rubbish: Calculate Bin Reminders'
  alias: 'Rubbish: Calculate Bin Reminders'
  trigger:
  - at: '19:00:00'
    platform: time
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ now().strftime("%H:%M") == "19:00" and now().weekday() ==
        1 }}'
    - condition: or
      conditions:
      - condition: state
        entity_id: sensor.recycling_bin_today
        state: 'True'
      - condition: state
        entity_id: sensor.landfill_bin_today
        state: 'True'
  action:
  - data_template:
      message: "'{%- if (states.sensor.recycling_bin_today.state) == \"True\" -%}\
        \ \n  Recycling Bin Night \n {%- elif (states.sensor.landfill_bin_today.state)\
        \ == \"True\" -%}\n   Landfill Bin Tonight \n {%- endif -%}\n {%- if (states.sensor.garden_bin_today.state)\
        \ == \"True\" -%}\n   Garden Bin Tonight \n {%- endif -%}'"
      title: Bins Out Tonight
    service: notify.everyone
  initial_state: 'true'
- id: 'Bedroom: Turn On Nightlight When Dark'
  alias: 'Bedroom: Turn On Nightlight When Dark'
  trigger:
  - device_id: 822656699269482e9e2b446f8689f43c
    domain: binary_sensor
    entity_id: binary_sensor.squiggley_nightlight_motion_sensor_occupancy
    platform: device
    type: motion
  - device_id: 34bc52dde87e40fc880a0095e7ebc56a
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_nightlight_motion_sensor_occupancy
    platform: device
    type: motion
  condition: []
  action:
  - data:
      entity_id: light.nightlight_stripper
    service: light.turn_on
  - delay: 00:05:00
  - data:
      entity_id: light.nightlight_stripper
    service: light.turn_off
- id: 'Bedroom: Light Wee Bears Wardrobe When The Door Opens'
  alias: 'Bedroom: Light Wee Bears Wardrobe When The Door Opens'
  trigger:
  - device_id: f006cfbf0dd948879ed5d99b79e8d087
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_one_contact
    platform: device
    type: opened
  - device_id: 45da12f50661448785e368a049276411
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_two_contact
    platform: device
    type: opened
  - device_id: 195b37745e4b4af5810f6207203be865
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_three_contact
    platform: device
    type: opened
  condition:
  - condition: state
    entity_id: light.large_wardrobe_stripper
    state: 'off'
  action:
  - data:
      entity_id: light.large_wardrobe_stripper
    service: light.turn_on
- id: 'Bedroom: Turn Off Wee Bears Wardrobe Light When The Door Closes'
  alias: 'Bedroom: Turn Off Wee Bears Wardrobe Light When The Door Closes'
  description: ''
  trigger:
  - device_id: f006cfbf0dd948879ed5d99b79e8d087
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_one_contact
    platform: device
    type: not_opened
  - device_id: 45da12f50661448785e368a049276411
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_two_contact
    platform: device
    type: not_opened
  - device_id: 195b37745e4b4af5810f6207203be865
    domain: binary_sensor
    entity_id: binary_sensor.wee_bear_wardrobe_door_three_contact
    platform: device
    type: not_opened
  condition:
  - condition: state
    entity_id: binary_sensor.wee_bear_wardrobe_door_one_contact
    state: 'off'
  - condition: and
    conditions:
    - condition: state
      entity_id: binary_sensor.wee_bear_wardrobe_door_two_contact
      state: 'off'
    - condition: and
      conditions:
      - condition: state
        entity_id: binary_sensor.wee_bear_wardrobe_door_three_contact
        state: 'off'
  action:
  - data:
      entity_id: light.large_wardrobe_stripper
    service: light.turn_off
- id: 'Bedroom: Turn Off Squiggley''s Wardrobe Light When The Door Closes'
  alias: 'Bedroom: Turn Off Squiggley''s Wardrobe Light When The Door Closes'
  description: ''
  trigger:
  - device_id: 5cda886b86794a49a9df3ff8c5a22c29
    domain: binary_sensor
    entity_id: binary_sensor.squiggley_wardrobe_door_contact
    platform: device
    type: not_opened
  condition: []
  action:
  - data:
      entity_id: light.small_wardrobe_stripper
    service: light.turn_off
- id: 'Bedroom: Light Squiggleys Wardrobe When The Door Opens'
  alias: 'Bedroom: Light Squiggleys Wardrobe When The Door Opens'
  trigger:
  - device_id: 5cda886b86794a49a9df3ff8c5a22c29
    domain: binary_sensor
    entity_id: binary_sensor.squiggley_wardrobe_door_contact
    platform: device
    type: opened
  condition: []
  action:
  - data:
      entity_id: light.small_wardrobe_stripper
    service: light.turn_on
- id: 'Bedroom: Turn House Off When Button Pressed'
  alias: 'Bedroom: Turn House Off When Button Pressed'
  description: Turn the whole house off when button pressed
  trigger:
  - entity_id: sensor.home_off_switch_click
    platform: state
  condition: []
  action:
  - service: script.home_off
  - data_template:
      entity_id: input_boolean.everyone_sleeping
    service: input_boolean.turn_on
- id: 'Occupancy: Turn On Garden Lights At Dusk'
  alias: 'Occupancy: Turn On Garden Lights At Dusk'
  trigger:
  - event: sunset
    offset: 01:00:00
    platform: sun
  condition: []
  action:
  - data:
      entity_id: group.front_garden_lights
    service: homeassistant.turn_on
- id: 'Occupancy: Turn On Lights When Dark and Someone Is Home'
  alias: 'Occupancy: Turn On Lights When Dark and Someone Is Home'
  trigger:
  - minutes: /1
    platform: time_pattern
  condition:
  - condition: state
    entity_id: input_boolean.everyone_sleeping
    state: 'off'
  - below: '400'
    condition: numeric_state
    entity_id: sensor.gateway_illumination_sensor
  - condition: state
    entity_id: sensor.house_occupancy_status
    state: 'on'
  - after: 07:00:00
    before: '23:00:00'
    condition: time
  - condition: state
    entity_id: group.common_lights
    state: 'off'
  action:
  - data:
      entity_id: group.common_lights
    service: homeassistant.turn_on
- id: 'Occupancy: Turn Everything Off When Everyone Leaves'
  alias: 'Occupancy: Turn Everything Off When Everyone Leaves'
  trigger:
  - entity_id: sensor.house_occupancy_status
    from: 'on'
    platform: state
    to: 'off'
  condition: []
  action:
  - data: {}
    service: script.home_off
  - service: media_player.turn_off
    entity_id:
    - media_player.marvin
  - data:
      message: Turning everything Off as nobody does be home
    service: notify.squiggley
- id: 'Occupancy: Turn On the Common Lights When Someone Opens the Front Door'
  alias: 'Occupancy: Turn On the Common Lights When Someone Opens the Front Door'
  trigger:
  - entity_id: binary_sensor.front_door_sensor
    from: 'off'
    platform: state
    to: 'on'
  condition:
  - below: '400'
    condition: numeric_state
    entity_id: sensor.gateway_illumination_sensor
  action:
  - condition: state
    entity_id: group.common_lights
    state: 'off'
  - data:
      entity_id: group.common_lights
    service: homeassistant.turn_on
  - delay: 00:10:00
  - data:
      entity_id: group.common_lights
    service: homeassistant.turn_off
- id: 'Occupancy: Announce Arrive/Leave Home'
  alias: 'Occupancy: Announce Arrive/Leave Home'
  trigger:
  - entity_id: device_tracker.claires_iphone_2, device_tracker.squigglepad_2
    from: not_home
    platform: state
    to: home
  - entity_id: device_tracker.claires_iphone_2, device_tracker.squigglepad_2
    from: home
    platform: state
    to: not_home
  action:
  - service: notify.squiggley
    data_template:
      message: '{{ trigger.to_state.attributes.friendly_name }} is {% if trigger.to_state.state
        == ''home'' %}back{% else %}away{% endif %}.

        '
      title: ''
  - service: tts.google_translate_say
    entity_id: media_player.office_speaker
    data_template:
      message: '{{ trigger.to_state.attributes.friendly_name }} is {% if trigger.to_state.state
        == ''home'' %}back{% else %}away{% endif %}.

        '
- id: 'Occupancy: Dev : Send message on location updates'
  alias: 'Occupancy: Dev : Send message on location updates'
  trigger:
  - entity_id: device_tracker.claires_iphone_2, device_tracker.squigglepad_2
    platform: state
  action:
  - service: notify.squiggley
    data_template:
      message: "{% if trigger.from_state.state != trigger.to_state.state %}\n  Update\
        \ from {{ trigger.to_state.attributes.friendly_name }} - state changed from\
        \ {{ trigger.from_state.state }} to {{ trigger.to_state.state }} Old Lattitude\
        \ = Latitude = {{ trigger.from_state.attributes.latitude }} New latitude =\
        \ Latitude = {{ trigger.to_state.attributes.latitude }}\n{% elif trigger.from_state.state\
        \ == trigger.to_state.state %}\n  {{ trigger.to_state.attributes.friendly_name\
        \ }} no state change. Latitude = {{ trigger.to_state.attributes.latitude }}\n\
        {% endif %}\n"
- id: 'Occupancy: Notify Squiggley when someone arrives home'
  alias: 'Occupancy: Notify Squiggley when someone arrives home'
  description: ''
  trigger:
  - entity_id: person.squiggley_woo
    event: enter
    platform: zone
    zone: zone.home
  - entity_id: person.wee_bear
    event: enter
    platform: zone
    zone: zone.home
  condition: []
  action:
  - data_template:
      message: '{{ trigger.to_state.attributes.friendly_name }} has arrived home waaaaaahoooooo!!!'
    service: notify.squiggley
- id: 'Occupancy: Notify Squiggley when someone leaves home'
  alias: 'Occupancy: Notify Squiggley when someone leaves home'
  description: ''
  trigger:
  - entity_id: person.squiggley_woo
    event: leave
    platform: zone
    zone: zone.home
  - entity_id: person.wee_bear
    event: enter
    platform: zone
    zone: zone.home
  condition: []
  action:
  - data_template:
      message: '{{ trigger.to_state.attributes.friendly_name }} has left the building!'
    service: notify.squiggley
- id: 'Server: Turn On The Fan When Its Hot'
  alias: 'Server: Turn On Fan When Its Hot'
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.server_room_temperature'') |float > states(''input_number.server_fan_on_temperature'')|
      float}}'
  action:
  - data:
      entity_id: switch.server_fan_relay
    service: switch.turn_on
- id: 'Server: Turn Off The Server Fan When It Has Cooled'
  alias: 'Server: Turn Off The Server Fan When It Has Cooled'
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.server_room_temperature'') |float < states(''input_number.server_fan_off_temperature'')|
      float}}'
  action:
  - data:
      entity_id: switch.server_fan_relay
    service: switch.turn_off
- id: 'Mousetrap: Notify Squiggley When a Mouse is Caught in Trap One'
  alias: 'Mousetrap: Notify Squiggley When a Mouse is Caught in Trap One'
  trigger:
  - entity_id: binary_sensor.mouse_trap_one
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      message: There's a moose been caught aboot this hoose! Trap One
    service: notify.squiggley
- id: 'Mousetrap: Notify Squiggley When a Mouse is Caught in Trap Two'
  alias: 'Mousetrap: Notify Squiggley When a Mouse is Caught in Trap Two'
  trigger:
  - entity_id: binary_sensor.mouse_trap_two
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      message: There's a moose been caught aboot this hoose! Trap Two
    service: notify.squiggley
- id: 'Toilet: Motion Detected And Door Closed Then Stop Timer And Set Occupied'
  alias: 'Toilet: Motion Detected And Door Closed Then Stop Timer And Set Occupied'
  trigger:
  - device_id: 47cd4607d0ce4b238cfbda038f535140
    domain: binary_sensor
    entity_id: binary_sensor.toilet_motion_sensor_occupancy
    platform: device
    type: motion
  condition:
  - condition: state
    entity_id: binary_sensor.toilet_door_sensor_contact
    state: 'off'
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.toilet_motion_sensor_occupancy
      state: 'on'
  action:
  - entity_id: timer.toilet_ceiling_lights_timer
    service: timer.cancel
  - entity_id: input_boolean.toilet_occupied
    service: input_boolean.turn_on
- id: 'Toilet: Occupied And Door Opened Then Start Timer'
  alias: 'Toilet: Occupied And Door Opened Then Start Timer'
  trigger:
  - device_id: 0f0c07f6241b40d8b9dfbd708c842a6e
    domain: binary_sensor
    entity_id: binary_sensor.toilet_door_sensor_contact
    platform: device
    type: opened
  condition:
  - condition: state
    entity_id: input_boolean.toilet_occupied
    state: 'on'
  - condition: and
    conditions:
    - condition: state
      entity_id: light.toilet_ceiling_lights
      state: 'on'
  action:
  - entity_id: input_boolean.toilet_occupied
    service: input_boolean.turn_off
  - data_template:
      duration: 00:{{ states.input_number.toilet_ceiling_lights_timer.state | int }}:00
      entity_id: timer.toilet_ceiling_lights_timer
    service: timer.start
- id: 'Toilet: Unoccupied, Door is Opened Then Turn On Lights And Start Timer'
  alias: 'Toilet: Unoccupied, Door is Opened Then Turn On Lights And Start Timer'
  trigger:
  - device_id: 0f0c07f6241b40d8b9dfbd708c842a6e
    domain: binary_sensor
    entity_id: binary_sensor.toilet_door_sensor_contact
    platform: device
    type: opened
  - device_id: 47cd4607d0ce4b238cfbda038f535140
    domain: binary_sensor
    entity_id: binary_sensor.toilet_motion_sensor_occupancy
    platform: device
    type: motion
  condition:
  - condition: state
    entity_id: input_boolean.toilet_occupied
    state: 'off'
  action:
  - entity_id: light.toilet_ceiling_lights
    service: light.turn_on
  - data_template:
      duration: 00:{{ states.input_number.toilet_ceiling_lights_timer.state | int }}:00
      entity_id: timer.toilet_ceiling_lights_timer
    service: timer.start
- id: 'Toilet: Turn off lights at end of timer'
  alias: 'Toilet: Turn off lights at end of timer'
  trigger:
  - event_data:
      entity_id: timer.toilet_ceiling_lights_timer
    event_type: timer.finished
    platform: event
  action:
  - entity_id: light.toilet_ceiling_lights
    service: light.turn_off
- id: 'Toilet: Occupied Turn vestibule One Light To Red'
  alias: 'Toilet: Occupied Turn vestibule One Light To Red'
  description: ''
  trigger:
  - entity_id: input_boolean.toilet_occupied
    from: 'off'
    platform: state
    to: 'on'
  condition: []
  action:
  - data:
      color_name: red
      entity_id: light.vestibule_one
    service: light.turn_on
- id: 'Vestibule: Turn On Lights When Motion Is Detected'
  alias: 'Vestibule: Turn On Lights When Motion Is Detected'
  trigger:
  - device_id: 7b7ac4ac6a3f4ff390fa7dce96a3959f
    domain: binary_sensor
    entity_id: binary_sensor.vestibule_motion_sensor_occupancy
    platform: device
    type: motion
  condition:
  - condition: state
    entity_id: light.vestibule_ceiling_lights
    state: 'off'
  action:
  - data: {}
    entity_id: light.vestibule_ceiling_lights
    service: light.turn_on
  - delay: 00:005:00
  - data: {}
    entity_id: light.vestibule_ceiling_lights
    service: light.turn_off
- id: 'Slow Cooker: Turn On at specified time'
  alias: 'Slow Cooker: Turn On at specified time'
  trigger:
  - platform: template
    value_template: '{{ states.sensor.time.state == (states.input_datetime.slow_cooker_start.attributes.timestamp
      | int | timestamp_custom("%H:%M", False)) }}'
  condition:
  - condition: state
    entity_id: input_boolean.slow_cooker_timer
    state: 'on'
  action:
  - data:
      entity_id: switch.slow_cooker_relay
    service: switch.turn_on
  - data:
      message: Turning on the slow cooker
    service: notify.squiggley
- id: 'Slow Cooker: Turn Off Slow Cooker at specified time'
  alias: 'Slow Cooker: Turn Off Slow Cooker at specified time'
  trigger:
  - platform: template
    value_template: '{{ states.sensor.time.state == (states.input_datetime.slow_cooker_stop.attributes.timestamp
      | int | timestamp_custom("%H:%M", False)) }}'
  condition:
  - condition: state
    entity_id: input_boolean.slow_cooker_timer
    state: 'on'
  action:
  - data:
      entity_id: switch.slow_cooker_relay
    service: switch.turn_off
  - data:
      message: Turning off the slow cooker
    service: notify.squiggley
- id: 'Livingroom: Moron Machine On/Off'
  alias: 'Livingroom: Moron Machine On/Off'
  description: For Google Assistant to be able to turn the moron machine on or off
  trigger:
    platform: state
    entity_id: input_boolean.moron_machine
  action:
    service: script.turn_on
    data_template:
      entity_id: "{% if is_state('sensor.moron_machine_status', 'on') %}\n  script.deactivate_moron_machine\n\
        {% elif is_state('sensor.moron_machine_status', 'off') %}\n  script.activate_moron_machine\n\
        {% endif %}\n"
- id: 'Livingroom: Toggle On/Off'
  alias: 'Livingroom: Toggle On/Off'
  description: Turns on the tv, amp, kodi, ambilighting and eventually lights
  trigger:
    platform: state
    entity_id: sensor.livingroom_on_off_switch_click
  condition: []
  action:
    service: script.turn_on
    data_template:
      entity_id: "{% if is_state('sensor.moron_machine_status', 'on') %}\n  script.deactivate_moron_machine\n\
        {% else %}\n  script.activate_moron_machine\n{% endif %}\n"
- id: 'Heating: Turn On Boost heating for room'
  alias: 'Heating: Turn On Boost heating for room'
  trigger:
  - entity_id: input_boolean.boost_vestibule_heating, input_boolean.boost_livingroom_heating,
      input_boolean.boost_office_heating, input_boolean.boost_kitchen_heating, input_boolean.boost_katrin_heating,
      input_boolean.boost_bedroom_heating
    from: 'off'
    platform: state
    to: 'on'
  action:
  - service: timer.start
    data_template:
      duration: '{% set entity_str =''input_number.''+trigger.entity_id.split(''_'')[2]+''_boost''%}    {%
        set mins = states[entity_str].state | int %}     00:{{mins}}:00'
      entity_id: timer.{{trigger.entity_id.split('_')[2]}}_boost_timer
  - service: climate.set_temperature
    data_template:
      entity_id: climate.{{trigger.entity_id.split('_')[2]}}
      temperature: '{{ states(''input_number.''+trigger.entity_id.split(''_'')[2]+''_temperature'')
        }}'
- id: 'Heating: Turn Off Boost heating for room'
  alias: 'Heating: Turn Off Boost heating for room'
  trigger:
  - entity_id: input_boolean.boost_vestibule_heating, input_boolean.boost_livingroom_heating,
      input_boolean.boost_office_heating, input_boolean.boost_kitchen_heating, input_boolean.boost_katrin_heating,
      input_boolean.boost_bedroom_heating
    from: 'on'
    platform: state
    to: 'off'
  action:
  - service: timer.cancel
    data_template:
      entity_id: timer.{{trigger.entity_id.split('_')[2]}}_boost_timer
  - service: climate.set_temperature
    data_template:
      entity_id: climate.{{trigger.entity_id.split('_')[2]}}
      temperature: 7
- id: 'Heating: Active/deactivate heating schedule for room'
  alias: 'Heating: Active/deactivate heating schedule for room'
  trigger:
  - platform: state
    entity_id: sensor.vestibule_heating_on, sensor.vestibule_heating_off, sensor.livingroom_heating_on,
      sensor.livingroom_heating_off, sensor.office_heating_on, sensor.office_heating_off,
      sensor.kitchen_heating_on, sensor.kitchen_heating_off, sensor.katrin_heating_on,
      sensor.katrin_heating_off, sensor.bedroom_heating_on, sensor.bedroom_heating_off
    to: 'True'
  action:
    service_template: input_boolean.turn_{{ trigger.entity_id.split('_')[-1] }}
    data_template:
      entity_id: "{% if trigger.entity_id.split('_')[2] == 'on'  %}\n  input_boolean.{{\
        \ trigger.entity_id.split('.')[1].replace('heating_on', 'schedule_active')\
        \ }}\n{% else %}\n  input_boolean.{{ trigger.entity_id.split('.')[1].replace('heating_off',\
        \ 'schedule_active') }}\n{% endif %}\n"
- id: 'Heating: Turn on when schedule is active and house is occupied'
  alias: 'Heating: Turn on when schedule is active and house is occupied'
  trigger:
    platform: state
    entity_id: input_boolean.vestibule_schedule_active, input_boolean.livingroom_schedule_active,
      input_boolean.office_schedule_active, input_boolean.kitchen_schedule_active,
      input_boolean.katrin_schedule_active, input_boolean.bedroom_schedule_active
    to: 'on'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: sensor.house_occupancy_status
      state: 'on'
    - condition: template
      value_template: '{{ is_state(''input_boolean.''+trigger.entity_id.split(''_'')[1].replace(''boolean.'','''')+''_schedule_active'',
        ''on'')}}'
  action:
  - service: climate.set_temperature
    data_template:
      entity_id: climate.{{trigger.entity_id.split('_')[1].replace('boolean.', '')}}
      temperature: '{{ states(''input_number.''+trigger.entity_id.split(''_'')[1].replace(''boolean.'',
        '''')+''_temperature'') }}'
  - service: notify.squiggley
    data_template:
      message: Activated by schedule {{trigger.entity_id.split('_')[1].replace('boolean.',
        '')}} to {{ states('input_number.'+trigger.entity_id.split('_')[1].replace('boolean.',
        '')+'_temperature') }}
- id: 'Heating: Turn on when schedule is active and Someone Arrives Home'
  alias: 'Heating: Turn on when schedule is active and Someone Arrives Home'
  trigger:
    platform: state
    entity_id: sensor.house_occupancy_status
    to: 'on'
  condition:
    condition: or
    conditions:
    - condition: state
      entity_id: input_boolean.vestibule_schedule_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.livingroom_schedule_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.office_schedule_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.kitchen_schedule_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.katrin_schedule_active
      state: 'on'
    - condition: state
      entity_id: input_boolean.bedroom_schedule_active
      state: 'on'
  action:
    service: notify.squiggley
    data:
      message: Need to work out which rooms we shout turn the heating on in
      title: Heating Automation
- id: 'Heating: Turn off when schedule becomes inactive'
  alias: 'Heating: Turn off when schedule becomes inactive'
  trigger:
    platform: state
    entity_id: input_boolean.vestibule_schedule_active, input_boolean.livingroom_schedule_active,
      input_boolean.office_schedule_active, input_boolean.kitchen_schedule_active,
      input_boolean.katrin_schedule_active, input_boolean.bedroom_schedule_active
    to: 'off'
  action:
  - service: climate.set_temperature
    data_template:
      entity_id: climate.{{ trigger.entity_id.split('_')[1].replace('boolean.', '')}}
      temperature: 7
  - service: notify.squiggley
    data_template:
      message: Deactivated by schedule {{trigger.entity_id.split('_')[1].replace('boolean.',
        '')}} to 7 }}
- id: 'Heating: Turn All Heating off week day nights'
  alias: 'Heating: Turn All Heating off week day nights'
  trigger:
    platform: template
    value_template: '{{ states(''sensor.time'') == (states.input_datetime.heating_all_rooms_week_night_stop.attributes.timestamp
      | int | timestamp_custom(''%H:%M'', False)) }}'
  condition:
    condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sun
  action:
    service: script.turn_on
    data_template:
      entity_id: script.turn_heating_off
- id: 'Heating: Turn All Heating off weekend nights'
  alias: 'Heating: Turn All Heating off weekend nights'
  trigger:
    platform: template
    value_template: '{{ states(''sensor.time'') == (states.input_datetime.heating_all_rooms_weekend_night_stop.attributes.timestamp
      | int | timestamp_custom(''%H:%M'', False)) }}'
  condition:
    condition: time
    weekday:
    - fri
    - sat
  action:
    service: script.turn_on
    data_template:
      entity_id: script.turn_heating_off
- id: 'Movie Night: Marvin Movie Playing'
  alias: 'Movie Night: Marvin Movie Playing'
  trigger:
  - entity_id: media_player.zaphod
    platform: state
    to: playing
  condition:
  - condition: state
    entity_id: input_boolean.movie_lighting
    state: 'on'
  action:
  - data:
      brightness_pct: '0'
      entity_id: light.movie_lights
      transition: 5
    service: light.turn_on
- id: 'Movie Night: Movie Ended'
  alias: 'Movie Night: Movie Ended'
  trigger:
  - entity_id: media_player.zaphod
    platform: state
    to: idle
  condition:
  - condition: state
    entity_id: input_boolean.movie_lighting
    state: 'on'
  action:
  - data:
      brightness_pct: '75'
      entity_id: light.movie_lights
      transition: 3
    service: light.turn_on
- id: 'Movie Night: Movie Paused'
  alias: 'Movie Night: Movie Paused'
  trigger:
  - entity_id: media_player.zaphod
    from: playing
    platform: state
    to: paused
  condition:
  - condition: state
    entity_id: input_boolean.movie_lighting
    state: 'on'
  action:
  - data:
      brightness_pct: '40'
      entity_id: light.movie_lights
      transition: 2
    service: light.turn_on
- id: 'Zigbee: Enable Zigbee Join'
  alias: 'Zigbee: Enable Zigbee Join'
  hide_entity: true
  trigger:
    platform: state
    entity_id: input_boolean.zigbee_permit_join
    to: 'on'
  action:
  - service: mqtt.publish
    data:
      topic: zigbee2mqtt/bridge/config/permit_join
      payload: 'true'
  - service: timer.start
    data:
      entity_id: timer.zigbee_permit_join
- id: 'Zigbee: Disable Zigbee Join'
  alias: 'Zigbee: Disable Zigbee Join'
  trigger:
  - entity_id: input_boolean.zigbee_permit_join
    platform: state
    to: 'off'
  action:
  - data:
      payload: 'false'
      topic: zigbee2mqtt/bridge/config/permit_join
    service: mqtt.publish
  - data:
      entity_id: timer.zigbee_permit_join
    service: timer.cancel
  hide_entity: true
- id: 'Zigbee: Disable Zigbee Join Timer'
  alias: 'Zigbee: Disable Zigbee Join Timer'
  hide_entity: true
  trigger:
  - platform: event
    event_type: timer.finished
    event_data:
      entity_id: timer.zigbee_permit_join
  action:
  - service: mqtt.publish
    data:
      topic: zigbee2mqtt/bridge/config/permit_join
      payload: 'false'
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.zigbee_permit_join
- id: Sunset Transition
  alias: Sunset Transition
  description: Sunset Transition
  trigger:
  - platform: time_pattern
    minutes: /2
    seconds: 0
  condition:
    condition: and
    conditions:
    - condition: time
      after: '16:00:00'
      before: '23:00:00'
    - condition: numeric_state
      entity_id: sensor.sun_elevation
      above: '0'
      below: '9'
    - condition: or
      conditions:
      - condition: template
        value_template: '{{ states.light.dog_lamps.attributes.brightness < (((0.0625*(states.sun.sun.attributes.elevation**2))-(31.125*states.sun.sun.attributes.elevation)+246.5)|int)
          }} '
      - condition: template
        value_template: '{{ states.light.dog_lamps.attributes.brightness==null }} '
  action:
  - data:
      entity_id: light.dog_lamps
    service: light.turn_on
- id: 'Car Defroster: Start Monitoring Temperature'
  alias: 'Car Defroster: Start Monitoring Temperature'
  description: 'Car Defroster: Start Monitoring Temperature'
  trigger:
  - at: 08:11
    platform: time
  condition:
  - condition: state
    entity_id: sensor.house_occupancy_status
    state: 'on'
  action:
  - data:
      entity_id: automation.car_defroster_flash_light_if_car_needs_defrosted
    service: automation.turn_on
- id: 'Car Defroster: Flash Light If Car Needs Defrosted'
  alias: 'Car Defroster: Flash Light If Car Needs Defrosted'
  description: 'Car Defroster: Flash Light If Car Needs Defrosted'
  trigger:
  - platform: time_pattern
    seconds: /30
  condition:
  - below: '10'
    condition: numeric_state
    entity_id: sensor.front_garden_temperature
  action:
  - data:
      brightness: '200'
      color: blue
      delay: '01'
      light_id: light.xiaomi_gateway_light
      transition: '1'
    service: script.pulselight_loop
- id: 'Car Defroster: Stop Monitoring Temperature'
  alias: 'Car Defroster: Stop Monitoring Temperature'
  description: 'Car Defroster: Stop Monitoring Temperature'
  trigger:
  - at: 08:13
    platform: time
  condition: []
  action:
  - data:
      entity_id: automation.car_defroster_flash_light_if_car_needs_defrosted
    service: automation.turn_off
  - data: {}
    service: script.pulselight_stop
- id: 'Xmas: Turn On Garden Lights At Dusk'
  alias: 'Xmas: Turn On Garden Lights At Dusk'
  trigger:
  - event: sunset
    offset: 01:00:00
    platform: sun
  condition: []
  action:
  - data:
      entity_id: group.outside_xmas_lights
    service: homeassistant.turn_on
- id: 'Front Door: Turn On Lights When Someone Is At The Front Door'
  alias: 'Front Door: Turn On Lights When Someone Is At The Front Door'
  description: ''
  trigger:
  - device_id: f894d9904a6e4ab68c6aef0c13f66778
    domain: binary_sensor
    entity_id: binary_sensor.external_front_door_motion_sensor_occupancy
    platform: device
    type: motion
  condition:
  - condition: state
    entity_id: light.front_door_eve_lights
    state: 'off'
  action:
  - entity_id: light.front_door_eve_lights
    service: light.turn_on
  - delay: 00:05:00
  - entity_id: light.front_door_eve_lights
    service: light.turn_off
- id: 'Bedroom: Turn On Lights When Switch One Clicked'
  alias: 'Bedroom: Turn On Lights When Switch One Clicked'
  description: ''
  trigger:
  - device_id: ae3368569840475b8364e629b48d2632
    domain: binary_sensor
    entity_id: binary_sensor.bedroom_light_switch_one_contact
    platform: device
    type: opened
  - device_id: ae3368569840475b8364e629b48d2632
    domain: binary_sensor
    entity_id: binary_sensor.bedroom_light_switch_one_contact
    platform: device
    type: not_opened
  condition: []
  action:
  - entity_id: light.bedroom_ceiling_one
    service: light.toggle
  - entity_id: light.bedroom_ceiling_two
    service: light.toggle
- id: 'Bedroom: Turn On Lights When Switch Two Clicked'
  alias: 'Bedroom: Turn On Lights When Switch Two Clicked'
  description: ''
  trigger:
  - device_id: 42af7668dbaf4e018ec666b69e105813
    domain: binary_sensor
    entity_id: binary_sensor.bedroom_light_switch_two_contact
    platform: device
    type: opened
  - device_id: 42af7668dbaf4e018ec666b69e105813
    domain: binary_sensor
    entity_id: binary_sensor.bedroom_light_switch_two_contact
    platform: device
    type: not_opened
  condition: []
  action:
  - entity_id: light.bedroom_ceiling_three
    service: light.toggle
  - entity_id: light.bedroom_ceiling_four
    service: light.toggle
  - entity_id: light.bedroom_ceiling_five
    service: light.toggle
- id: 'Heating: Turn Off When Boost Timer is Finished'
  alias: 'Heating: Turn Off When Boost Timer is Finished'
  description: ''
  trigger:
  - event_data:
      entity_id: timer.vestibule_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.livingroom_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.office_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.kitchen_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.bathroom_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.katrin_boost_timer
    event_type: timer.finished
    platform: event
  - event_data:
      entity_id: timer.bedroom_boost_timer
    event_type: timer.finished
    platform: event
  condition: []
  action:
  - data_template:
      entity_id: input_boolean.boost_{{ trigger.event.data.entity_id.split('.',1)[1].split('_')[0] }}_heating
    service: input_boolean.turn_off
- id: 'Zigbee2MqttMap: Update every 10 mins'
  alias: 'Zigbee2MqttMap: Update every 10 mins'
  description: ''
  trigger:
  - minutes: /10
    platform: time_pattern
  condition: []
  action:
  - service: zigbee2mqtt_networkmap.update
